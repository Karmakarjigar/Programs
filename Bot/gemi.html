<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forex Trading Bot Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 flex flex-col items-center">

    <div class="max-w-4xl w-full bg-white shadow-xl rounded-2xl p-6">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Forex Trading Bot Simulator</h1>
        <p class="text-center text-gray-600 mb-8">
            This application simulates a simple moving average crossover strategy. It generates synthetic price data and visualizes "Buy" and "Sell" signals.
            <br>
            <strong>Note:</strong> This is for educational purposes only and does not use real-time data or execute actual trades.
        </p>

        <div class="mb-6">
            <canvas id="priceChart"></canvas>
        </div>

        <div class="flex justify-center space-x-4 mb-8">
            <button id="runButton" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300">
                Run Simulation
            </button>
            <button id="stopButton" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-full shadow-lg hover:bg-red-700 transition-all duration-300">
                Stop Simulation
            </button>
        </div>
        
        <div id="log" class="bg-gray-200 text-gray-800 p-4 rounded-xl max-h-64 overflow-y-auto">
            <h2 class="text-lg font-semibold mb-2">Simulation Log</h2>
            <!-- Log entries will be added here -->
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Configuration variables
            const fastMA = 10;
            const slowMA = 30;
            const pricePoints = 200;
            let currentDataIndex = 0;
            let isRunning = false;
            let intervalId = null;
            let hasPosition = false;
            let lastSignal = null;

            // DOM elements
            const runButton = document.getElementById('runButton');
            const stopButton = document.getElementById('stopButton');
            const logContainer = document.getElementById('log');
            const priceChartCanvas = document.getElementById('priceChart').getContext('2d');

            // Generate synthetic price data with some noise and trend
            const generateData = (count) => {
                const data = [];
                let price = 1.2000;
                for (let i = 0; i < count; i++) {
                    price += (Math.random() - 0.5) * 0.001; // Base noise
                    price += Math.sin(i / 10) * 0.0005; // Add some sine wave for a trend
                    data.push(price);
                }
                return data;
            };

            const historicalPrices = generateData(pricePoints);

            // Calculate moving averages
            const calculateMovingAverage = (data, period, index) => {
                if (index < period - 1) return null;
                let sum = 0;
                for (let i = 0; i < period; i++) {
                    sum += data[index - i];
                }
                return sum / period;
            };

            // Initialize chart
            const chart = new Chart(priceChartCanvas, {
                type: 'line',
                data: {
                    labels: Array.from({ length: pricePoints }, (_, i) => i + 1),
                    datasets: [
                        {
                            label: 'Price',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)',
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            pointRadius: 0,
                            borderWidth: 2,
                            tension: 0.1,
                        },
                        {
                            label: `Fast MA (${fastMA})`,
                            data: [],
                            borderColor: 'rgb(249, 115, 22)',
                            backgroundColor: 'rgba(249, 115, 22, 0.2)',
                            pointRadius: 0,
                            borderWidth: 2,
                            tension: 0.1,
                        },
                        {
                            label: `Slow MA (${slowMA})`,
                            data: [],
                            borderColor: 'rgb(22, 163, 74)',
                            backgroundColor: 'rgba(22, 163, 74, 0.2)',
                            pointRadius: 0,
                            borderWidth: 2,
                            tension: 0.1,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Price'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                }
            });

            // Function to add a new log entry
            const addLogEntry = (message, type = 'info') => {
                const logItem = document.createElement('p');
                const timestamp = new Date().toLocaleTimeString();
                logItem.className = `p-2 rounded-lg my-1`;
                if (type === 'buy') {
                    logItem.classList.add('bg-green-300', 'text-green-900');
                } else if (type === 'sell') {
                    logItem.classList.add('bg-red-300', 'text-red-900');
                } else {
                    logItem.classList.add('bg-gray-300', 'text-gray-900');
                }
                logItem.textContent = `[${timestamp}] ${message}`;
                logContainer.prepend(logItem);
                // Keep the log from getting too long
                if (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            };

            // Main simulation loop
            const simulate = () => {
                if (!isRunning || currentDataIndex >= pricePoints) {
                    stopSimulation();
                    return;
                }

                // Add new data point
                const newPrice = historicalPrices[currentDataIndex];
                chart.data.datasets[0].data.push(newPrice);
                
                const fastMAValue = calculateMovingAverage(historicalPrices, fastMA, currentDataIndex);
                const slowMAValue = calculateMovingAverage(historicalPrices, slowMA, currentDataIndex);
                
                chart.data.datasets[1].data.push(fastMAValue);
                chart.data.datasets[2].data.push(slowMAValue);
                
                // Only check for signals after the MAs are calculable
                if (fastMAValue && slowMAValue) {
                    const signal = fastMAValue > slowMAValue ? 'buy' : 'sell';

                    if (signal !== lastSignal) {
                        if (signal === 'buy' && !hasPosition) {
                            addLogEntry(`BUY Signal: Fast MA (${fastMAValue.toFixed(4)}) crossed above Slow MA (${slowMAValue.toFixed(4)}) at price ${newPrice.toFixed(4)}`, 'buy');
                            hasPosition = true;
                        } else if (signal === 'sell' && hasPosition) {
                            addLogEntry(`SELL Signal: Fast MA (${fastMAValue.toFixed(4)}) crossed below Slow MA (${slowMAValue.toFixed(4)}) at price ${newPrice.toFixed(4)}`, 'sell');
                            hasPosition = false;
                        }
                    }
                    lastSignal = signal;
                }

                chart.update();
                currentDataIndex++;
            };

            // Control functions
            const startSimulation = () => {
                if (isRunning) return;
                isRunning = true;
                runButton.disabled = true;
                stopButton.disabled = false;
                addLogEntry('Simulation started.');
                intervalId = setInterval(simulate, 200); // Run every 200ms
            };

            const stopSimulation = () => {
                if (!isRunning) return;
                isRunning = false;
                runButton.disabled = false;
                stopButton.disabled = true;
                clearInterval(intervalId);
                addLogEntry('Simulation stopped.');
            };

            // Event listeners
            runButton.addEventListener('click', startSimulation);
            stopButton.addEventListener('click', stopSimulation);
            stopButton.disabled = true;

            // Initial chart rendering
            chart.update();
        });
    </script>
</body>
</html>
